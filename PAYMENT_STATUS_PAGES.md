# ğŸ“‹ æ”¯ä»˜çŠ¶æ€ç¡®è®¤é¡µé¢ä½¿ç”¨æŒ‡å—

## ğŸ¯ ä½ å¯ä»¥åœ¨ä»¥ä¸‹é¡µé¢ç¡®è®¤æ”¯ä»˜çŠ¶æ€ï¼š

### **1. ç”¨æˆ·æ”¯ä»˜é¡µé¢** (`/payment`)
**ç”¨æˆ·ä½¿ç”¨** - ç”¨äºæŸ¥çœ‹å’Œç¡®è®¤æ”¯ä»˜çŠ¶æ€

ğŸ”— **è®¿é—®æ–¹å¼ï¼š**
```
http://localhost:3000/payment?orderNumber=è®¢å•å·
```

ğŸ“‹ **åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… **30åˆ†é’Ÿå€’è®¡æ—¶**ï¼šå®æ—¶æ˜¾ç¤ºå‰©ä½™æ”¯ä»˜æ—¶é—´
- ğŸ”„ **è‡ªåŠ¨åˆ·æ–°**ï¼šæ¯30ç§’è‡ªåŠ¨æ£€æŸ¥æ”¯ä»˜çŠ¶æ€
- ğŸ“± **æ‰‹åŠ¨ç¡®è®¤**ï¼šç”¨æˆ·å¯ä»¥æ‰‹åŠ¨ç¡®è®¤å·²æ”¯ä»˜
- ğŸ¯ **çŠ¶æ€æ˜¾ç¤º**ï¼šæ¸…æ™°æ˜¾ç¤ºæ”¯ä»˜çŠ¶æ€ï¼ˆå¾…æ”¯ä»˜/å·²æ”¯ä»˜/å·²è¿‡æœŸï¼‰
- ğŸ”— **å¿«é€Ÿå¯¼èˆª**ï¼šç›´æ¥è·³è½¬åˆ°è®¢å•è¿½è¸ªé¡µé¢

**é¡µé¢ç‰¹ç‚¹ï¼š**
```typescript
æ”¯ä»˜çŠ¶æ€å¾½ç« ï¼š
- ğŸŸ  å¾…æ”¯ä»˜ï¼šæ˜¾ç¤ºå‰©ä½™æ”¯ä»˜æ—¶é—´
- ğŸŸ¢ å·²æ”¯ä»˜ï¼šæ˜¾ç¤ºæ”¯ä»˜å®Œæˆ
- ğŸ”´ å·²è¿‡æœŸï¼šæ˜¾ç¤ºæ”¯ä»˜è¶…æ—¶

åŠŸèƒ½æŒ‰é’®ï¼š
- âœ… æˆ‘å·²æ”¯ä»˜ï¼Œç¡®è®¤è®¢å•ï¼ˆç”¨æˆ·è‡ªä¸»ç¡®è®¤ï¼‰
- ğŸ“± è”ç³»å®¢æœç¡®è®¤æ”¯ä»˜
- ğŸ“‹ æŸ¥çœ‹é¡¹ç›®è¿›åº¦
```

---

### **2. ç®¡ç†å‘˜æ”¯ä»˜ç®¡ç†é¡µé¢** (`/admin/payment`)
**å®¢æœ/ç®¡ç†å‘˜ä½¿ç”¨** - æ‰¹é‡ç®¡ç†å’Œç¡®è®¤æ”¯ä»˜

ğŸ”— **è®¿é—®æ–¹å¼ï¼š**
```
http://localhost:3000/admin/payment
```

ğŸ“Š **åŠŸèƒ½ç‰¹æ€§ï¼š**
- ğŸ“ˆ **ç»Ÿè®¡æ¦‚è§ˆ**ï¼šå¾…æ”¯ä»˜ã€å·²è¿‡æœŸã€å·²æ”¯ä»˜è®¢å•æ•°é‡
- ğŸ” **æœç´¢è¿‡æ»¤**ï¼šæŒ‰è®¢å•å·ã€å®¢æˆ·å§“åã€é¡¹ç›®æ ‡é¢˜æœç´¢
- â° **å€’è®¡æ—¶æ˜¾ç¤º**ï¼šæ¯ä¸ªè®¢å•çš„å‰©ä½™æ”¯ä»˜æ—¶é—´
- âœ… **æ‰¹é‡ç¡®è®¤**ï¼šä¸€é”®ç¡®è®¤ç”¨æˆ·æ”¯ä»˜
- ğŸ”„ **æ¢å¤è®¢å•**ï¼šå¯ä»¥æ¢å¤å·²è¿‡æœŸçš„è®¢å•
- ğŸ§¹ **å¤„ç†è¿‡æœŸ**ï¼šæ‰¹é‡å¤„ç†è¿‡æœŸè®¢å•

**ç®¡ç†ç•Œé¢åˆ†åŒºï¼š**
```typescript
1. æœç´¢æ ï¼šå¿«é€ŸæŸ¥æ‰¾ç‰¹å®šè®¢å•
2. ç»Ÿè®¡å¡ç‰‡ï¼š
   - ğŸŸ  å¾…æ”¯ä»˜è®¢å•ï¼šéœ€è¦ç¡®è®¤çš„è®¢å•
   - ğŸ”´ å·²è¿‡æœŸè®¢å•ï¼šè¶…æ—¶æœªæ”¯ä»˜çš„è®¢å•  
   - ğŸŸ¢ å·²æ”¯ä»˜è®¢å•ï¼šå·²ç¡®è®¤æ”¯ä»˜çš„è®¢å•

3. è®¢å•åˆ—è¡¨ï¼š
   - å¾…æ”¯ä»˜è®¢å•ï¼šæ˜¾ç¤ºå€’è®¡æ—¶ï¼Œå¯ä»¥ç¡®è®¤æ”¯ä»˜
   - å·²è¿‡æœŸè®¢å•ï¼šæ˜¾ç¤ºè¿‡æœŸçŠ¶æ€ï¼Œå¯ä»¥æ¢å¤
   - å·²æ”¯ä»˜è®¢å•ï¼šæ˜¾ç¤ºæ”¯ä»˜æ—¶é—´å’Œæ–¹å¼
```

---

### **3. è®¢å•è¿½è¸ªé¡µé¢** (`/tracking`)
**ç”¨æˆ·ä½¿ç”¨** - æŸ¥çœ‹è®¢å•æ•´ä½“çŠ¶æ€åŒ…æ‹¬æ”¯ä»˜ä¿¡æ¯

ğŸ”— **è®¿é—®æ–¹å¼ï¼š**
```
http://localhost:3000/tracking
```

ğŸ“ **æ”¯ä»˜çŠ¶æ€æ˜¾ç¤ºï¼š**
- è®¢å•è¯¦æƒ…ä¸­åŒ…å«æ”¯ä»˜çŠ¶æ€
- æ˜¾ç¤ºæ”¯ä»˜æˆªæ­¢æ—¶é—´
- æ˜¾ç¤ºæ”¯ä»˜æ–¹å¼å’Œæ—¶é—´ï¼ˆå¦‚æœå·²æ”¯ä»˜ï¼‰

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### **ç”¨æˆ·æ”¯ä»˜æµç¨‹ï¼š**
```mermaid
flowchart TD
    A[ç”¨æˆ·ä¸‹å•] --> B[è·³è½¬æ”¯ä»˜é¡µé¢]
    B --> C[æŸ¥çœ‹30åˆ†é’Ÿå€’è®¡æ—¶]
    C --> D[é€‰æ‹©æ”¯ä»˜æ–¹å¼]
    D --> E[å®Œæˆæ”¯ä»˜]
    E --> F[ç‚¹å‡»"æˆ‘å·²æ”¯ä»˜ï¼Œç¡®è®¤è®¢å•"]
    F --> G[ç³»ç»Ÿç¡®è®¤æ”¯ä»˜çŠ¶æ€]
    G --> H[è·³è½¬è®¢å•è¿½è¸ªæŸ¥çœ‹è¿›åº¦]
```

### **ç®¡ç†å‘˜ç¡®è®¤æµç¨‹ï¼š**
```mermaid
flowchart TD
    A[ç®¡ç†å‘˜ç™»å½•] --> B[è®¿é—®æ”¯ä»˜ç®¡ç†é¡µé¢]
    B --> C[æŸ¥çœ‹å¾…æ”¯ä»˜è®¢å•åˆ—è¡¨]
    C --> D[æ ¸å¯¹ç”¨æˆ·æ”¯ä»˜å‡­è¯]
    D --> E[ç‚¹å‡»"ç¡®è®¤æ”¯ä»˜"æŒ‰é’®]
    E --> F[ç³»ç»Ÿæ›´æ–°è®¢å•çŠ¶æ€]
    F --> G[å‘é€ç¡®è®¤é€šçŸ¥ç»™ç”¨æˆ·]
```

---

## ğŸ› ï¸ APIæ¥å£

### **ç”¨æˆ·ç›¸å…³ï¼š**
```bash
# æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
GET /api/payment/status/[orderNumber]

# ç”¨æˆ·ç¡®è®¤æ”¯ä»˜
POST /api/payment/confirm
{
  "orderNumber": "GS202508225825",
  "paymentMethod": "alipay",
  "isManual": true,
  "operator": "customer_self_confirm"
}
```

### **ç®¡ç†å‘˜ç›¸å…³ï¼š**
```bash
# è·å–è®¢å•åˆ—è¡¨
GET /api/orders?status=pending

# ç®¡ç†å‘˜ç¡®è®¤æ”¯ä»˜
POST /api/payment/confirm
{
  "orderNumber": "GS202508225825", 
  "paymentMethod": "manual",
  "isManual": true,
  "operator": "admin_user"
}

# å¤„ç†è¿‡æœŸè®¢å•
POST /api/admin/expired-orders
```

---

## ğŸ“± é¡µé¢è®¿é—®å¯¼èˆª

### **ä»ä¸åŒé¡µé¢è·³è½¬åˆ°æ”¯ä»˜ç¡®è®¤ï¼š**

1. **ä»è®¢å•é¡µé¢** â†’ æ”¯ä»˜é¡µé¢
   ```
   /order â†’ /payment?orderNumber=è®¢å•å·
   ```

2. **ä»è®¢å•è¿½è¸ª** â†’ æ”¯ä»˜é¡µé¢
   ```
   /tracking â†’ ç‚¹å‡»æ”¯ä»˜é“¾æ¥ â†’ /payment?orderNumber=è®¢å•å·
   ```

3. **ç®¡ç†å‘˜åå°** â†’ æ”¯ä»˜ç®¡ç†
   ```
   /admin â†’ /admin/payment
   ```

### **é¡µé¢é“¾æ¥å…³ç³»ï¼š**
```
é¦–é¡µ (/)
â”œâ”€â”€ è®¢å•åˆ›å»º (/order)
â”‚   â””â”€â”€ æ”¯ä»˜é¡µé¢ (/payment)
â”‚       â””â”€â”€ è®¢å•è¿½è¸ª (/tracking)
â””â”€â”€ ç®¡ç†åå° (/admin)
    â””â”€â”€ æ”¯ä»˜ç®¡ç† (/admin/payment)
        â””â”€â”€ è®¢å•è¯¦æƒ… (/admin/orders/[id])
```

---

## âœ… **æ€»ç»“ï¼šæ”¯ä»˜çŠ¶æ€ç¡®è®¤çš„ä¸‰ä¸ªå…¥å£**

1. **ğŸ™‹â€â™‚ï¸ ç”¨æˆ·è‡ªä¸»ç¡®è®¤**ï¼š`/payment` é¡µé¢ - ç”¨æˆ·æ”¯ä»˜åè‡ªå·±ç¡®è®¤
2. **ğŸ‘¨â€ğŸ’¼ ç®¡ç†å‘˜ç¡®è®¤**ï¼š`/admin/payment` é¡µé¢ - å®¢æœæ‰¹é‡ç®¡ç†ç¡®è®¤
3. **ğŸ“Š çŠ¶æ€æŸ¥è¯¢**ï¼š`/tracking` é¡µé¢ - æŸ¥çœ‹æ”¯ä»˜çŠ¶æ€å’Œè¿›åº¦

**æœ€å¸¸ç”¨çš„æ˜¯ç¬¬2ä¸ªç®¡ç†å‘˜é¡µé¢ï¼Œè¿™æ˜¯å®¢æœå·¥ä½œçš„ä¸»è¦ç•Œé¢ï¼** ğŸ¯